/*! Fizz - v0.0.2 | (c) 2014 Michael Zalla | MIT License */
/*! Read the full source at https://github.com/MichaelZalla/Fizz */
this.Fizz=this.Fizz||{},function(){Fizz.noop=function(){},Object.defineProperty(Object.prototype,"exposeProperty",{value:function(a,b,c){"undefined"==typeof b&&(b="_"+a),"string"==typeof b&&(b=new Function("return this."+b)),"function"!=typeof c&&(c=Fizz.noop),Object.defineProperty(this,a,{get:b,set:c,configurable:!0,enumerable:!1})},writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(Object.prototype,"banishProperty",{value:function(a,b){b="undefined"==typeof b?!0:b,Object.defineProperty(this,a,{get:Fizz.noop,set:Fizz.noop,configurable:!1,enumerable:!1}),b&&"undefined"!=typeof this["_"+a]&&this.banishProperty("_"+a,!1)},writeable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(Object.prototype,"assign",{value:function(a){if(null===a||"object"!=typeof a)return this;for(var b in a)a.hasOwnProperty(b)&&void 0!==a[b]&&(this[b]=a[b]);return this},writeable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(Object.prototype,"extend",{value:function(a){function b(){if(!(this instanceof b))throw new Error("Constructor called without the 'new' keyword.");"init"in this&&this.init.apply(this,arguments)}b.prototype=Object.create(this.prototype),b.prototype.constructor=b;for(var c in a)a.hasOwnProperty(c)&&(b.prototype[c]=a[c]);return b},writeable:!1,configurable:!1,enumerable:!1}),"function"!=typeof Object.prototype.keys&&Object.defineProperty(Object.prototype,"keys",{value:function(){var a=[];for(var b in this)this.hasOwnProperty(b)&&a.push(b);return a},writeable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(Object.prototype,"foreach",{value:function(a,b){"undefined"==typeof b&&(b=this);var c=0;for(var d in this)this.hasOwnProperty(d)&&(a.call(b,this[d],d,c,this),c++)},writeable:!1,configurable:!1,enumerable:!1}),"function"!=typeof String.format&&(String.format=function(a){var b=Array.prototype.slice.call(arguments,1);return a.replace(/{(\d+)}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})})}(),this.Fizz=this.Fizz||{},function(){Fizz.restrict={},Fizz.restrict.toDataType=function(a,b,c){c="string"==typeof c?c:"this";var d=c+"."+a+"=(typeof value === '"+b+"')?value:"+c+"."+a+";";return new Function("value",d)},Fizz.restrict.toBoolean=function(a,b){return Fizz.restrict.toDataType(a,"boolean",b)},Fizz.restrict.toString=function(a,b){return arguments.length?Fizz.restrict.toDataType(a,"string",b):Object.prototype.toString.apply(this)},Fizz.restrict.toNumber=function(a,b){return Fizz.restrict.toDataType(a,"number",b)},Fizz.restrict.toInstanceType=function(a,b,c){c="string"==typeof c?c:"this";var d=c+"."+a+"=(value instanceof "+b+"||value === null)?value:"+c+"."+a+";";return new Function("value",d)},Fizz.restrict.toRange=function(a,b,c){if("undefined"==typeof b||!(b instanceof Array)||b.length<2)throw new Error("Attempt to restrict property to range with invalid range value");b=[Math.min.apply(this,b),Math.max.apply(this,b)],c="string"==typeof c?c:"this";var d="if(typeof value != 'number') return; "+c+"."+a+"=(value>="+b[0].toString()+")?((value <= "+b[1]+")?value:"+b[1]+"):"+b[0]+";";return new Function("value",d)}}(),this.Fizz=this.Fizz||{},function(){function a(a){return b.keys().map(function(a){return b[a]}).reduce(function(b,c){return b||c===a},!1)}var b={PRODUCTION:"prod",DEVELOPMENT:"dev"},c=window.FIZZ_ENVIRONMENT||b.PRODUCTION;Fizz.getEnv=function(){return c},Fizz.setEnv=function(b){a(b)&&(c=b)}}(),this.Fizz=this.Fizz||{},function(){var a=Fizz.getEnv(),b=function(){Fizz.logger&&Fizz.throws("Error: The Logger class cannot be instantiated!")};b.prototype.filter=function(b){return a="all"===b?Fizz.getEnv():b.toString().toLowerCase(),this},b.prototype.log=function(){return a===Fizz.getEnv()?(window.console.log("Fizz ["+Fizz.getEnv().toUpperCase()+"]  "+String.format.apply(this,arguments)),this):void 0},b.prototype.debug=function(){return a===Fizz.getEnv()?(window.console.debug("Fizz ["+Fizz.getEnv().toUpperCase()+"]  "+String.format.apply(this,arguments)),this):void 0},b.prototype.info=function(){return a===Fizz.getEnv()?(window.console.info("Fizz ["+Fizz.getEnv().toUpperCase()+"]  "+String.format.apply(this,arguments)),this):void 0},b.prototype.warn=function(){return a===Fizz.getEnv()?(window.console.warn("Fizz ["+Fizz.getEnv().toUpperCase()+"]  "+String.format.apply(this,arguments)),this):void 0},b.prototype.error=function(){if(a===Fizz.getEnv())throw new Error("Fizz ["+Fizz.getEnv().toUpperCase()+"]  "+String.format.apply(this,arguments))},Fizz.logger=new b,Fizz.throws=function(a){this.filter("all").error(a)}.bind(Fizz.logger),Fizz.logger.filter("dev").log("Loaded module 'Logger'.")}(),this.Fizz=this.Fizz||{},function(){var a={};a.randomInt=function(a,b){return 0===arguments.length&&(a=0,b=1),1===arguments.length&&(b=a,a=0),Math.floor(Math.random()*(b+1-a))+Math.floor(a)},a.randomFloat=function(a,b){return 0===arguments.length&&(a=0,b=1),1===arguments.length&&(b=a,a=0),Math.random()*(b-a)+a},a.mapToDomain=function(a,b,c){if("number"==typeof a&&(a=[0,a]),!(a instanceof Array))throw new Error("Must provide a valid domain input!");if(a=[Math.min.apply(this,a),Math.max.apply(this,a)],b="undefined"==typeof b?[0,1]:b,"number"==typeof b&&(b=[0,b]),!(b instanceof Array))throw new Error("Must provide a valid range input!");if(b=[Math.min.apply(this,b),Math.max.apply(this,b)],a[0]===b[0]&&a[1]===b[1])return c;var d=a[1]-a[0],e=b[1]-b[0],f=parseFloat(d/e);return a[0]+(c-b[0])*f},a.wrapAround=function(a,b){if("number"==typeof a&&(a=[0,a]),!(a instanceof Array))throw new Error("Must provide a valid domain input!");if(a=[Math.min.apply(this,a),Math.max.apply(this,a)],b!==b)throw new Error("Must provide a valid value input!");for(var c=a[1]-a[0];b<=a[0];)b+=c;return b%c-1},a.random=a.randomFloat.bind(this,0,1),Fizz.math=a,Fizz.logger.filter("dev").log("Loaded module 'Math'.")}(),this.Fizz=this.Fizz||{},function(){var a=Object.extend({init:function(a,b,c,d){switch(this._r=0,this._g=0,this._b=0,this._alpha=1,arguments.length){case 1:if(arguments[0]instanceof Array)this.init.apply(this,arguments[0]);else if("string"==typeof arguments[0]){for(var e=arguments[0].replace("#",""),f=0;f<e.length;f+=2){var g=["_r","_g","_b"][f/2];this[g]=parseInt(e.substring(f,f+2),16)}this._alpha=1}break;case 4:this.alpha=d;case 3:this.r=a,this.g=b,this.b=c}},add:function(a){if(a instanceof Fizz.Color)for(var b,c=0;3>c;c++)b=["r","g","b"][c],this[b]+=a[b];return this},subtract:function(a){if(a instanceof Fizz.Color)for(var b,c=0;3>c;c++)b=["r","g","b"][c],this[b]-=a[b];return this},equals:function(a,b){if(!(a instanceof Fizz.Color))return!1;"boolean"!=typeof b&&(b=!1);var c=this._r===a._r&&this._g===a._g&&this._b===a._b;return b?c&&this._alpha===a._alpha:c},copy:function(a){return a instanceof Fizz.Color&&this.init.call(this,a.toList(!0)),this},clone:function(){var b=new a;return b.copy(this),b},toRGB:function(a){var b=a?"rgba":"rgb";return b+"("+this.toList(a).toString()+")"},toHex:function(){var a=["_r","_g","_b"].map(function(a){return("0"+this[a].toString(16)).slice(-2)}.bind(this));return"#"+a.toString().replace(/,/g,"")},toList:function(a){return"boolean"!=typeof a&&(a=!1),[this._r,this._g,this._b].concat(a?this._alpha:[])},toString:function(){return"[Color ("+this.toList(!0)+")]"}});a.exposeProperty("BLACK",function(){return new a("#000000")}),a.exposeProperty("GRAY",function(){return new a("#808080")}),a.exposeProperty("WHITE",function(){return new a("#FFFFFF")}),a.exposeProperty("CLEAR",function(){return new a(0,0,0,0)}),a.exposeProperty("LIME",function(){return new a("#00ff00")}),a.exposeProperty("CYAN",function(){return new a("#00FFFF")}),a.exposeProperty("MAGENTA",function(){return new a("#FF00FF")}),a.exposeProperty("RED",function(){return new a("#FF0000")}),a.exposeProperty("YELLOW",function(){return new a("#FFFF00")}),a.exposeProperty("GREEN",function(){return new a("#008000")}),a.exposeProperty("BLUE",function(){return new a("#0000FF")});var b=[0,Math.pow(2,8)];a.prototype.exposeProperty("r","_r",Fizz.restrict.toRange("_r",b)),a.prototype.exposeProperty("g","_g",Fizz.restrict.toRange("_g",b)),a.prototype.exposeProperty("b","_b",Fizz.restrict.toRange("_b",b)),a.prototype.exposeProperty("alpha","_alpha",Fizz.restrict.toRange("_alpha",[0,1])),Fizz.Color=a,Fizz.logger.filter("dev").log("Loaded module 'Color'.")}(),this.Fizz=this.Fizz||{},function(){var a=Object.extend({init:function(b,c,d){if(this._bubbles=!0,this._cancelable=!0,this._canceled=!1,this._immediatelyCanceled=!1,this._type=null,this._target=null,this._currentTarget=null,this._eventPhase=a.PHASE.NONE,this._timeStamp=Date.now(),null!==arguments[0]&&"object"==typeof arguments[0]){var e=arguments[0];this.assign(e)}else switch(arguments.length){case 3:this.cancelable=d;case 2:this.bubbles=c;case 1:this.type=b}},stopPropagation:function(){this._canceled=!0},stopImmediatePropagation:function(){this._immediatelyCanceled=!0,this.stopPropagation()},copy:function(a){a.foreach(function(a,b){this[b]=a},this)},clone:function(){var a=new Fizz.Event;return a.copy(this),a},toString:function(){return String.format("[Event (type='{0}', target='{1}')]",this._type,this._target)}});a.PHASE={},a.PHASE.NONE=0,a.PHASE.CAPTURING_PHASE=1,a.PHASE.AT_TARGET=2,a.PHASE.BUBBLING_PHASE=3,a.prototype.exposeProperty("bubbles","_bubbles",Fizz.restrict.toBoolean("_bubbles")),a.prototype.exposeProperty("cancelable","_cancelable",Fizz.restrict.toBoolean("_bubbles")),a.prototype.exposeProperty("canceled","_canceled",Fizz.restrict.toBoolean("_bubbles")),a.prototype.exposeProperty("immediatelyCanceled","_immediatelyCanceled",Fizz.restrict.toBoolean("_bubbles")),a.prototype.exposeProperty("type","_type",Fizz.restrict.toString("_type")),a.prototype.exposeProperty("eventPhase","_eventPhase",Fizz.restrict.toNumber("_eventPhase")),a.prototype.exposeProperty("timeStamp","_timeStamp",Fizz.restrict.toNumber("_timeStamp")),a.prototype.exposeProperty("target","_target",Fizz.restrict.toInstanceType("_target","Object")),a.prototype.exposeProperty("currentTarget","_currentTarget",Fizz.restrict.toInstanceType("_currentTarget","Object")),Fizz.Event=a,Fizz.logger.filter("dev").log("Loaded module 'Event'.")}(),this.Fizz=this.Fizz||{},function(){var a=Object.extend({init:function(){this._parent=null,this._events={}},addEventListener:function(a,b,c){c="boolean"==typeof c?c:!1,b.useCapture=c;var d=a.replace(/(\s)/,"").split(/[ ,]+/);if(d.length>1&&(a=d),a instanceof Array)a.foreach(function(a){this.addEventListener(a,b)});else{if(Fizz.logger.filter("dev").log("Adding '{0}' listener to {1} (useCapture='{2}')",a,this.toString(),c.toString()),!(a in this._events))return void(this._events[a]=b);if("function"==typeof this._events[a]){if(this._events[a]===b)return;this._events[a]=[this._events[a]],this._events[a].push(b)}if(-1<this._events[a].indexOf(b))return;this._events[a].push(b)}},removeEventListener:function(a,b,c){c="boolean"==typeof c?c:!1;var d=a.replace(/(\s)/,"").split(/[ ,]+/);if(d.length>1&&(a=d),a instanceof Array)for(var e=0;e<a.length;e++)this.removeEventListener(a[e],b);else{if(this._events[a]===b)return void delete this._events[a];var f=this._events[a].indexOf(b);f>-1&&(this._events[a].splice(f,1),1===this._events[a].length?this._events[a]=this._events[a][0]:0===this._events[a].length&&delete this._events[a])}},getEventListeners:function(a,b){b="boolean"==typeof b?b:!1;var c=[],d=this._events[a];return"function"==typeof d&&d.useCapture===b?c.push(d):d instanceof Array&&(c=d.filter(function(a){return a.useCapture===b})),c},listensFor:function(a){return!!(a in this._events)},emit:function(a,b){var c;a instanceof Fizz.Event?c=a:"function"==typeof a?c=new a:"string"==typeof a?c=new Fizz.Event({type:a}):Fizz.throws("Call was made to 'emit' method with invalid value for 'eventObj'. Argument must be a string or Fizz.Event instance"),c.target=this,c.assign(b);var d,e,f,g=this._buildCapturePath(),h=g.slice(0).reverse();for(c.eventPhase=Fizz.Event.PHASE.CAPTURING_PHASE,d=0;d<g.length;d++){if(c.canceled)return c.currentTarget;for(c.currentTarget=g[d],f=c.currentTarget.getEventListeners(c.type,!0),e=0;e<f.length;e++){if(c.canceled)return c.currentTarget;f[e].call(c.currentTarget,c)}}for(c.eventPhase=Fizz.Event.PHASE.BUBBLING_PHASE,d=0;d<h.length;d++){if(c.canceled)return c.currentTarget;for(c.currentTarget=h[d],f=c.currentTarget.getEventListeners(c.type,!1),e=0;e<f.length;e++){if(c.canceled)return c.currentTarget;f[e].call(c.currentTarget,c)}}return c.currentTarget},toString:function(){return String.format("[EventEmitter (activeListeners='"+this._events.keys().toString()+"')]")},_buildCapturePath:function(){for(var a=this,b=[];a;)b.unshift(a),a=a.parent;return b}});a.initialize=function(b){if(a.prototype.foreach(function(a,c){-1===["constructor","init","toString"].indexOf(c)&&(b[c]=this[c])},a.prototype),b.hasOwnProperty("init")&&"function"==typeof b.init){var c=new Function("return "+b.init.toString())();for(var d in b.init)c[d]=b.init[d];b.init=function(){a.prototype.init.call(this),c.apply(this,arguments)}}else a.prototype.init.call(this)},a.prototype.on=a.prototype.addEventListener,a.prototype.off=a.prototype.removeEventListener,a.prototype.exposeProperty("parent","_parent",Fizz.restrict.toInstanceType("_parent","Fizz.EventEmitter")),Fizz.EventEmitter=a,Fizz.logger.filter("dev").log("Loaded module 'EventEmitter'.")}(),this.Fizz=this.Fizz||{},function(){var a=Object.extend({init:function(a,b){this._x=0,this._y=0,this.x=a,this.y=b},add:function(a){return new Fizz.Point(this._x+a.x,this._y+a.y)},scale:function(a,b){1===arguments.length&&(b=a),this.x*=a,this.y*=b},equals:function(a){return!(this._x!==a.x||this._y!==a.y)},distanceFrom:function(a){return Math.sqrt(Math.pow(a.x-this.x,2)+Math.pow(a.y-this.y,2))},copy:function(a){this.x=a.x,this.y=a.y},clone:function(){return new Fizz.Point(this._x,this._y)},toList:function(){return[this._x,this._y]},toString:function(){return String.format("[Point (x='{0}', y='{1}')]",this._x,this._y)}});a.prototype.exposeProperty("x","_x",Fizz.restrict.toNumber("_x")),a.prototype.exposeProperty("y","_y",Fizz.restrict.toNumber("_y")),a.prototype.exposeProperty("length",function(){return this.distanceFrom(new Fizz.Point(0,0))}),Fizz.Point=a,Fizz.logger.filter("dev").log("Loaded module 'Point'.")}(),this.Fizz=this.Fizz||{},function(){var a=Object.extend({init:function(a,b){this._position=new Fizz.Point(0,0),this._size=new Fizz.Point(0,0),a&&(a instanceof Fizz.Point?this.position=a.clone():2===a.length&&(this.position.x=a[0],this.position.y=a[1])),b&&(b instanceof Fizz.Point?this.size=b.clone():2===b.length&&(this.size.x=b[0],this.size.y=b[1]))},intersects:function(a){return a instanceof Array?a.reduce(function(a,b){return a&&this.intersects(b)}.bind(this),!0):(a instanceof Fizz.Point&&(a=new Fizz.Rectangle(a)),a instanceof Fizz.Rectangle?!(this.top>a.bottom||this.bottom<a.top||this.left>a.right||this.right<a.left):!1)},copy:function(a){return this.init(a.position.clone(),a.size.clone())},clone:function(){return new Fizz.Rectangle(this._position.clone(),this._size.clone())},toString:function(){return String.format("[Rectangle (x='{0}', y='{1}', width='{2}', height='{3}')]",this._position.x,this._position.y,this._size.x,this._size.y)}});a.prototype.exposeProperty("position","_position",Fizz.restrict.toInstanceType("_position","Fizz.Point")),a.prototype.exposeProperty("size","_size",Fizz.restrict.toInstanceType("_size","Fizz.Point")),a.prototype.exposeProperty("x","_position.x",Fizz.restrict.toNumber("_position.x")),a.prototype.exposeProperty("y","_position.y",Fizz.restrict.toNumber("_position.y")),a.prototype.exposeProperty("width","_size.x",Fizz.restrict.toNumber("_size.x")),a.prototype.exposeProperty("height","_size.y",Fizz.restrict.toNumber("_size.y")),a.prototype.exposeProperty("left",function(){return this._position.x}),a.prototype.exposeProperty("top",function(){return this._position.y}),a.prototype.exposeProperty("right",function(){return this._position.x+this._size.x}),a.prototype.exposeProperty("bottom",function(){return this._position.y+this._size.y}),Fizz.Rectangle=a,Fizz.logger.filter("dev").log("Loaded module 'Rectangle'.")}(),this.Fizz=this.Fizz||{},function(){var a=function(){Fizz.throws("UID object cannot be instantiated!")};a.get=function(){return a._nextID++},a._nextID=0,Fizz.UID=a,Fizz.logger.filter("dev").log("Loaded module 'UID'.")}(),this.Fizz=this.Fizz||{},function(){var a=Fizz.Rectangle.extend({init:function(a,b){Fizz.Rectangle.prototype.init.call(this,a,b),this._guid=Fizz.UID.get(),this._life=1/0,this._scale=new Fizz.Point(1,1),this._velocity=new Fizz.Point(0,0),this._acceleration=new Fizz.Point(0,0),this.name="Entity_"+this._guid,this.exists=!0},update:function(a){a="number"==typeof a?a:1,(this._life-=a)<1&&this.kill(),this._velocity.x+=this._acceleration.x*a,this._velocity.y+=this._acceleration.y*a,this.x+=this._velocity.x*a,this.y+=this._velocity.y*a},kill:function(){return this.emit(Fizz.Entity.EVENTS.DEATH),this.exists=!1,this.parent=null,this},copy:function(a){return a instanceof Fizz.Entity||a instanceof Fizz.Rectangle?(this.position=a.position.clone(),this.size=a.size.clone(),a instanceof Fizz.Entity&&(this.exists=a.exists,this._scale=a.scale.clone(),this._velocity=a.velocity.clone(),this._acceleration=a.acceleration.clone()),this):!1},clone:function(){var a=new Fizz.Entity;return a.copy(this),a},toString:function(){return String.format("[Entity (name='{0}')]",this.name)},_getGlobalPosition:function(){return null===this.parent?new Fizz.Point(this.x,this.y):new Fizz.Point(this.x,this.y).add(this.parent._getGlobalPosition())}});Fizz.EventEmitter.initialize(a.prototype),a.EVENTS={},a.EVENTS.CLICK="click",a.EVENTS.DBLCLICK="dblclick",a.EVENTS.MOUSEMOVE="mouseMove",a.EVENTS.MOUSEDOWN="mousedown",a.EVENTS.MOUSEUP="mouseup",a.EVENTS.ADDED="added",a.EVENTS.REMOVED="removed",a.EVENTS.DEATH="death",a.prototype.exposeProperty("guid"),a.prototype.exposeProperty("parent","_parent",Fizz.restrict.toInstanceType("_parent","Fizz.Entity")),a.prototype.exposeProperty("life","_life",Fizz.restrict.toNumber("_life")),a.prototype.exposeProperty("scale","_scale",Fizz.restrict.toInstanceType("_scale","Fizz.Point")),a.prototype.exposeProperty("velocity","_velocity",Fizz.restrict.toInstanceType("_velocity","Fizz.Point")),a.prototype.exposeProperty("acceleration","_acceleration",Fizz.restrict.toInstanceType("_acceleration","Fizz.Point")),a.prototype.exposeProperty("globalPosition",function(){return this._getGlobalPosition()}),a.prototype.exposeProperty("stage",function(){return null===this.parent||Fizz.Stage&&this.parent instanceof Fizz.Stage?this.parent:this.parent.stage}),a.prototype.exposeProperty("right",function(){return this._position.x+this._size.x*Math.abs(this._scale.x)}),a.prototype.exposeProperty("bottom",function(){return this._position.y+this._size.y*Math.abs(this._scale.y)}),a.prototype.exposeProperty("width",function(){return this.size.x*Math.abs(this.scale.x)}),a.prototype.exposeProperty("height",function(){return this.size.y*Math.abs(this.scale.y)}),Fizz.Entity=a,Fizz.logger.filter("dev").log("Loaded module 'Entity'.")}(),this.Fizz=this.Fizz||{},function(){var a=Object.extend({init:function(b,c,d,e){!1==b instanceof Fizz.Entity&&Fizz.throws("EntityPool must be instantiated with a valid Entity prototype"),this._pool=[],this._size=0,this._sizeIsDynamic=!0,this._activeEntityCount=0,this._firstAvailable=null,this._prototypeEntity=b,this._prototypeEntity.exists=!1,this._resetFn="function"==typeof e?e:this._prototypeEntity.reset?this._prototypeEntity.reset:Fizz.noop,this.sizeIsDynamic=d,c="number"==typeof c?c:a.DEFAULT_SIZE,c>0&&this._grow(c)},reserve:function(){var a=this._firstAvailable;if(null===a){if(!this._sizeIsDynamic)return a;this._grow(this._size||1),a=this._firstAvailable}return this._firstAvailable=a._next,a._next=null,this._resetFn.call(a),a.exists=!0,this._activeEntityCount+=1,a},release:function(a){a._next=this._firstAvailable,this._firstAvailable=a,this._activeEntityCount-=1},drain:function(){Fizz.logger.filter("dev").log("Draining pool to size zero"),this._firstAvailable=null,this._size=0,this._activeEntityCount=0,this._pool=[]},toString:function(){return String.format("[EntityPool (size='{0}', activeEntityCount='{1}')]",this._size,this._activeEntityCount)},_grow:function(a){a="number"==typeof a&&a>0?a:1,a>1&&Fizz.logger.filter("dev").log("Growing pool to size {0}",this._size+a);for(var b=0;a>b;b++){var c=this._prototypeEntity.clone();c._next=null,this._pool.push(c),this._size+=1,null===this._firstAvailable?this._firstAvailable=c:this._pool[this._size-2]._next=c}}});a.DEFAULT_SIZE=0,a.prototype.exposeProperty("size"),a.prototype.exposeProperty("activeEntityCount"),a.prototype.exposeProperty("sizeIsDynamic","_sizeIsDynamic",Fizz.restrict.toBoolean("_sizeIsDynamic")),a.prototype.exposeProperty("resetFn","_resetFn",Fizz.restrict.toDataType("_resetFn","function")),Fizz.EntityPool=a,Fizz.logger.filter("dev").log("Loaded module 'EntityPool'.")}(),this.Fizz=this.Fizz||{},function(){var a=Fizz.Entity.extend({init:function(b){var c=[];"object"==typeof b&&null!==b&&(c=[b.position,b.size],delete b.position,delete b.size),Fizz.Entity.prototype.init.apply(this,c),this._caching=!1,this._snapToPixel=!1,this._cacheCanvas=null,this._cacheCanvasContext=null,this._alpha=1,this._fillStyle=a.BOUNDING_BOX_FILL_STYLE,this._strokeStyle=a.BOUNDING_BOX_STROKE_STYLE,this._lineWidth=a.BOUNDING_BOX_LINE_WIDTH,"object"==typeof b&&null!==b&&this.assign(b)},draw__optimized:function(a){if("undefined"==typeof a)return!1;if(!1===this.exists)return!1;var b=this._getGlobalPosition();this._snapToPixel&&(b.x=Math.floor(b.x),b.y=Math.floor(b.y)),this._isVisible()&&((null===this._cacheCanvas||!1===this._caching)&&this.updateCache(),a.globalAlpha=this._getGlobalAlpha(),a.imageSmoothingEnabled=a.mozImageSmoothingEnabled=a.webkitImageSmoothingEnable=!this._snapToPixel,a.drawImage(this._cacheCanvas,b.x,b.y)),"dev"===Fizz.getEnv()&&(a.globalAlpha=1,a.beginPath(),a.rect(b.x+.5,b.y+.5,this.width,this.height),a.closePath(),a.strokeStyle=this._strokeStyle.toRGB(!0),a.lineWidth=this._lineWidth,a.stroke())},draw:function(a){a.beginPath(),a.rect(.5,.5,this.width*Math.abs(this.scale.x)-1,this.height*Math.abs(this.scale.y)-1),a.closePath(),a.fillStyle=this._fillStyle.toRGB(!0),a.fill()},updateCache:function(){null===this._cacheCanvas&&(this._cacheCanvas=document.createElement("canvas"),this._cacheCanvasContext=this._cacheCanvas.getContext("2d")),(this.width!==this._cacheCanvas.width||this.height!==this._cacheCanvas.height)&&(this._cacheCanvas.width=Math.floor(this.width)+1,this._cacheCanvas.height=Math.floor(this.height)+1),this._cacheCanvasContext.clearRect(.5,.5,this.width,this.height),this._cacheCanvasContext.save(),this.draw(this._cacheCanvasContext),this._cacheCanvasContext.restore()},copy:function(a){if(Fizz.Entity.prototype.copy.call(this,a),a instanceof Fizz.DisplayEntity){this.alpha=a.alpha,this.lineWidth=a.lineWidth,a.fillStyle!==Fizz.DisplayEntity.DEFAULT_FILL_STYLE&&(this.fillStyle=(new Fizz.Color).copy(a.fillStyle)),a.strokeStyle!==Fizz.DisplayEntity.DEFAULT_STROKE_STYLE&&(this.strokeStyle=(new Fizz.Color).copy(a.strokeStyle));var b=document.createElement("canvas");b.width=a.width+1,b.height=a.height+1;var c=new Fizz.Canvas(b);this._cacheCanvas=c.splice(),this._cacheCanvas.scale=this.scale.clone(),this._cacheCanvasContext=this._cacheCanvas.getContext("2d")}},clone:function(){var a=new Fizz.DisplayEntity;return a.copy(this),a},toString:function(){return String.format("[DisplayEntity (name='{0}')]",this.name)},_getGlobalAlpha:function(){return null===this.parent?this._alpha:this._alpha*this.parent._getGlobalAlpha()},_isVisible:function(){return!1===this.exists?!1:0===this._alpha?!1:0===this.width?!1:0===this.height?!1:0===this.scale.x?!1:0===this.scale.y?!1:!0}});a.BOUNDING_BOX_FILL_STYLE=Fizz.Color.WHITE,a.BOUNDING_BOX_STROKE_STYLE=Fizz.Color.YELLOW,a.BOUNDING_BOX_LINE_WIDTH=1,a.EVENTS={},a.prototype.exposeProperty("fillStyle","_fillStyle",Fizz.restrict.toInstanceType("_fillStyle","Fizz.Color")),a.prototype.exposeProperty("strokeStyle","_strokeStyle",Fizz.restrict.toInstanceType("_strokeStyle","Fizz.Color")),a.prototype.exposeProperty("lineWidth","_lineWidth",Fizz.restrict.toRange("_lineWidth",[0,999])),a.prototype.exposeProperty("caching","_caching",Fizz.restrict.toBoolean("_caching")),a.prototype.exposeProperty("snapToPixel","_snapToPixel",Fizz.restrict.toBoolean("_snapToPixel")),a.prototype.exposeProperty("scale","_scale",function(a){a instanceof Fizz.Point&&(this._scale=a,this.updateCache())}),a.prototype.exposeProperty("scaleX","_scale.x",function(a){"number"==typeof a&&a!==this._scale.x&&(this._scale.x=a,this.updateCache())}),a.prototype.exposeProperty("scaleY","_scale.y",function(a){"number"==typeof a&&a!==this._scale.y&&(this._scale.y=a,this.updateCache())}),a.prototype.exposeProperty("alpha","_alpha",Fizz.restrict.toRange("_alpha",[0,1])),a.prototype.exposeProperty("visible",function(){return this._isVisible()}),Fizz.DisplayEntity=a,Fizz.logger.filter("dev").log("Loaded module 'DisplayEntity'.")}(),this.Fizz=this.Fizz||{},function(){var a=Fizz.DisplayEntity.extend({init:function(a,b){this._children=[],arguments[0]instanceof Fizz.DisplayEntity||arguments[0]instanceof Array?(Fizz.DisplayEntity.prototype.init.call(this,null,b),this.addChild(arguments[0])):Fizz.DisplayEntity.prototype.init.call(this,a,b)},update:function(a){Fizz.DisplayEntity.prototype.update.call(this,a),this._children.slice(0).foreach(function(b){b.update(a)})},updateCache:function(){var a=this._getChildrenBoundingBox(),b=a[1].x-a[0].x,c=a[1].y-a[0].y;if(this.size.x=b,this.size.y=c,Fizz.DisplayEntity.prototype.updateCache.call(this),!0===this._caching){this._cacheCanvas.width=this.size.x,this._cacheCanvas.height=this.size.y;var d=this._cacheCanvasContext;d.clearRect(0,0,d.canvas.width,d.canvas.height),this.children.foreach(function(a){if(a instanceof Fizz.DisplayEntity){var b=a.x,c=a.y,e=a.scaleX,f=a.scaleY;a.x-=this.x,a.y-=this.y,a.scaleX=e*this._scale.x,a.scaleY=f*this._scale.y,a.updateCache(),a.draw(d),a.x=b,a.y=c,a.scaleX=e,a.scaleY=f}},this)}},draw__optimized:function(a){return!1===this._caching?void this.children.foreach(function(b){b.draw__optimized(a)}):void Fizz.DisplayEntity.prototype.draw__optimized.call(this,a)},indexOf:function(a){return this._children.indexOf(a)},childAt:function(a){return 0>a||a>=this._children.length?null:this._children[a]},contains:function(a){return this.indexOf(a)>-1},getChildByName:function(a){if(0===this._children.length)return null;for(var b=0;b<this._children.length;b++)if(this._children[b].name===a)return this._children[b];return null},setIndexOfChild:function(a,b){if(-1===this.indexOf(a))return!1;var c=this._children.length;b=0>b?0:b,b=b>c-1?c:b,this.addChildAt(a,b)},addChild:function(){var a=Array.prototype.slice.call(arguments,0);return this.addChildAt.call(this,a)},addChildAt:function(a,b){return arguments.length>2&&(a=a.splice(0,a.length-1),b=a[a.length-1]),b="number"==typeof b?b:this._children.length,a instanceof Array?a.reduce(function(a,c,d){return a&&this.addChildAt(c,b+d)}.bind(this),!0):Fizz.Stage&&a instanceof Fizz.Stage?!1:a instanceof Fizz.Entity?(null!==a.parent&&a.parent.removeChild(a),a.parent=this,this._children.splice(b,0,a),a.emit(Fizz.Entity.EVENTS.ADDED,{}),!0):!1},removeChild:function(a){if(arguments.length>1&&(a=[a]),a instanceof Array)return a.reduce(function(a,b){return b}.bind(this),null);if(!(a instanceof Fizz.Entity))return null;var b=this.indexOf(a);return-1===b?null:(a.parent=null,this._children.splice(b,1),a.emit(Fizz.Entity.EVENTS.REMOVED,{}),a)},removeChildAt:function(a){if(0>a||a>=this._children.length)return null;var b=this._children[a];return b.parent=null,this._children.splice(a,1),b.emit(Fizz.Entity.EVENTS.REMOVED,{}),b},sort:function(a){this._children.sort(a)},empty:function(){if(0===this._children.length)return!0;var a=this._children.slice(0);return a.reduce(function(){return this.removeChild(this._children[0])}.bind(this),!0)},copy:function(a){Fizz.DisplayEntity.prototype.copy.call(this,a),a instanceof Fizz.DisplayGroup&&(this.empty(),a.children.foreach(function(a,b){this.addChild(a.clone(),b)},this))},clone:function(){var a=new Fizz.DisplayGroup;return a.copy(this),a},toString:function(){return String.format("[DisplayGroup (name='{0}', children='{1}')]",this.name,this.children.length)},_getChildrenBoundingBox:function(){var a=null,b=null,c=null,d=null;return this._children.foreach(function(e){"number"!=typeof a&&(a=e.y),"number"!=typeof b&&(b=e.x),"number"!=typeof c&&(c=e.x+e.width),"number"!=typeof d&&(d=e.y+e.height),e.y<a&&(a=e.y),e.x<b&&(b=e.x),e.x+e.width>c&&(c=e.x+e.width),e.y+e.height>d&&(d=e.y+e.height)}),[new Fizz.Point(b,a),new Fizz.Point(c-b,d-a)]}});a.EVENTS={},a.prototype.add=a.prototype.addChild,a.prototype.remove=a.prototype.removeChild,a.prototype.exposeProperty("children"),a.prototype.exposeProperty("_size",function(){return this._getChildrenBoundingBox()[1]}),Fizz.DisplayGroup=a,Fizz.logger.filter("dev").log("Loaded module 'DisplayGroup'.")}(),this.Fizz=this.Fizz||{},function(){var a=Fizz.DisplayGroup.extend({init:function(b){Fizz.DisplayGroup.prototype.init.call(this,null),this._rows=a.DEFAULT_ORDER,this._columns=a.DEFAULT_ORDER,this._cellWidth=a.DEFAULT_CELL_SIZE,this._cellHeight=a.DEFAULT_CELL_SIZE,"object"==typeof b&&null!==b&&("rows"in b&&"number"==typeof b.rows&&(this._rows=b.rows,delete b.rows),"columns"in b&&"number"==typeof b.columns&&(this._columns=b.columns,delete b.columns),"cellWidth"in b&&"number"==typeof b.cellWidth&&(this._cellWidth=b.cellWidth,delete b.cellWidth),"cellHeight"in b&&"number"==typeof b.cellHeight&&(this._cellHeight=b.cellHeight,delete b.cellHeight),this.assign(b))},childAtCoordinate:function(a,b){return 0>a||a>=this._columns?null:0>b||b>=this._rows?null:this.childAt(b*this._columns+a)},addChild:function(a){if(this._children.length===this.capacity)return!1;if(arguments.length>1){var b=Array.prototype.slice.call(arguments,0);return this.addChild.call(this,b)}if(a instanceof Fizz.Entity&&(a=[a]),!(a instanceof Array))return!1;var c=!1;return a.foreach(function(a){if(this._children.length===this.capacity)return void(c=!0);var b,d,e,f,g=this._children.length;b=e=g?this._children[g-1].x:this._cellWidth*Math.abs(this._scale.x)*-1,d=f=g?this._children[g-1].y:0,b<(this._columns-1)*this._cellWidth*Math.abs(this._scale.x)?e+=this._cellWidth*Math.abs(this._scale.x):(e=0,f+=this._cellHeight*Math.abs(this._scale.y)),a._position=new Fizz.Point(e,f),Fizz.DisplayGroup.prototype.addChildAt.call(this,a)},this),!c},copy:function(a){Fizz.DisplayGroup.prototype.copy.call(this,a),a instanceof Fizz.DisplayGrid&&(this._rows=a.rows,this._columns=a.columns,this._children.foreach(this.addChild,this))},clone:function(){var b=new a;return b.copy(this),b},toString:function(){return String.format("[DisplayGrid (name='{0}')]",this.name)},_repopulate:function(){var a=this._children.slice(0);this.empty(),a.foreach(function(){this.addChildAt(this._children.length)})}});a.DEFAULT_ORDER=8,a.DEFAULT_CELL_SIZE=16,a.prototype.exposeProperty("rows","_rows",function(a){"number"==typeof a&&a!==this.rows&&a>=0&&(this._rows=a,this._repopulate())}),a.prototype.exposeProperty("columns","_columns",function(a){"number"==typeof a&&a!==this.columns&&a>=0&&(this._columns=a,this._repopulate())}),a.prototype.exposeProperty("cellWidth","_cellWidth",function(a){"number"==typeof a&&a!==this.cellWidth&&a>=0&&(this._cellWidth=a,this._repopulate())}),a.prototype.exposeProperty("cellHeight","_cellHeight",function(a){"number"==typeof a&&a!==this.cellHeight&&a>=0&&(this._cellHeight=a,this._repopulate())}),a.prototype.exposeProperty("capacity",function(){return this._rows*this._columns}),Fizz.DisplayGrid=a,Fizz.logger.filter("dev").log("Loaded module 'DisplayGrid'.")}(),this.Fizz=this.Fizz||{},function(){var a=Object.extend({init:function(a){this._DOMElement=document.createElement("canvas"),this._DOMElementListeners=[],this.element=a},scale:function(a,b,c){if(1===a&&1===b)return this.splice();c="boolean"==typeof c?c:!0;
var d=document.createElement("canvas");d.width=this._DOMElement.width*Math.abs(a),d.height=this._DOMElement.height*Math.abs(b);var e=new Fizz.Point(0>a?d.width:0,0>b?d.height:0),f=d.getContext("2d");return f.save(),f.imageSmoothingEnabled=f.mozImageSmoothingEnabled=f.webkitImageSmoothingEnabled=!c,f.translate.apply(f,e.toList()),f.scale(a,b),f.drawImage(this._DOMElement,0,0),f.restore(),d},splice:function(a,b,c,d){if(0===this._DOMElement.width||0===this._DOMElement.height)return document.createElement("canvas");if(arguments[0]&&arguments[0]instanceof Array)return this.splice.apply(this,arguments[0]);a="number"==typeof a?a:0,b="number"==typeof b?b:0,c="number"==typeof c?c:this._DOMElement.width,d="number"==typeof d?d:this._DOMElement.height;var e=document.createElement("canvas");e.width=c,e.height=d;var f=e.getContext("2d");return f.drawImage.apply(f,[this._DOMElement,a,b,c,d,0,0,c,d]),e},copy:function(a){a&&a instanceof Fizz.Canvas||Fizz.throws("Argument 'canvas' must be a Fizz.Canvas instance!"),this.width=a.width,this.height=a.height,this.element=a.splice()},clone:function(){var a=new Fizz.Canvas;return a.copy(this),a},toString:function(){return String.format("[Canvas (width='{0}', height='{1}')]",this.width,this.height)},_getWindowPosition:function(){var a=new Fizz.Point(0,0);if(this._DOMElement&&this._DOMElement.ownerDocument){var b=this._DOMElement.ownerDocument.documentElement,c=this._DOMElement.getBoundingClientRect();a.x=c.left-b.offsetLeft,a.y=c.top-b.offsetTop}return this._windowPosition=a.clone()},_bind:function(b){if(!(b instanceof HTMLCanvasElement))return null;var c={},d={keyCode:"keyCode"},e={button:"mouseButton",clientX:{property:"mouseX",transform:function(a){var c=b,d=c.clientWidth/c.width,e="number"==typeof a?a-this.windowPosition.x:0;return Math.floor(e/d)}},clientY:{property:"mouseY",transform:function(a){var c=b,d=c.clientHeight/c.height,e="number"==typeof a?a-this.windowPosition.y:0;return Math.floor(e/d)}}};c.click={type:{property:"type",transform:function(){return a.EVENTS.CLICK}}}.assign(e),c.dblclick={type:{property:"type",transform:function(){return a.EVENTS.DBLCLICK}}}.assign(e),c.mouseup={type:{property:"type",transform:function(){return a.EVENTS.MOUSEUP}}}.assign(e),c.mousedown={type:{property:"type",transform:function(){return a.EVENTS.MOUSEDOWN}}}.assign(e),c.mousemove={type:{property:"type",transform:function(){return a.EVENTS.MOUSEMOVE}}}.assign(e),c.keydown={type:{property:"type",transform:function(){return a.EVENTS.KEYDOWN}}}.assign(d),c.keyup={type:{property:"type",transform:function(){return a.EVENTS.KEYUP}}}.assign(d);var f=["keydown","keyup"];return c.foreach(function(a,c){var d=function(b){var c={};a.foreach(function(a,d){d in b&&("string"==typeof a?c[a]=b[d]:c[a.property]=a.transform.call(this,b[d]))},this),this.emit.call(this,c.type,c)}.bind(this),e=f.indexOf(c)>-1?window.document.body:b;e.addEventListener(c,d),this._DOMElementListeners.push({type:c,listener:d})},this),b.addEventListener("contextmenu",function(a){a.preventDefault()}),b}});Fizz.EventEmitter.initialize(a.prototype),a.EVENTS={},a.EVENTS.CLICK="click",a.EVENTS.DBLCLICK="dblclick",a.EVENTS.MOUSEUP="mouseup",a.EVENTS.MOUSEDOWN="mousedown",a.EVENTS.MOUSEMOVE="mousemove",a.EVENTS.KEYDOWN="keydown",a.EVENTS.KEYUP="keyup",a.prototype.exposeProperty("width","_DOMElement.width",Fizz.restrict.toNumber("_DOMElement.width")),a.prototype.exposeProperty("height","_DOMElement.height",Fizz.restrict.toNumber("_DOMElement.height")),a.prototype.exposeProperty("windowPosition",function(){return this._getWindowPosition()}),a.prototype.exposeProperty("element","_DOMElement",function(a){a instanceof HTMLCanvasElement&&(this._DOMElementListeners.foreach(function(a){this._DOMElement.removeEventListener(a.type,a.listener)}),this._DOMElement=this._bind(a))}),Fizz.Canvas=a,Fizz.logger.filter("dev").log("Loaded module 'Canvas'.")}(),this.Fizz=this.Fizz||{},function(){var a=Fizz.DisplayGroup.extend({init:function(){var b;if(arguments[0]instanceof CanvasRenderingContext2D)b=arguments[0];else if(arguments[0]instanceof HTMLCanvasElement)b=arguments[0].getContext("2d");else if("string"==typeof arguments[0]){var c=window.document.getElementById(arguments[0].replace("#",""));c&&(b=c.getContext("2d"))}else{var d="number"==typeof arguments[0]?d:a.DEFAULT_DIMENSIONS.x,e="number"==typeof arguments[1]?e:a.DEFAULT_DIMENSIONS.y;b=window.document.createElement("canvas").getContext("2d"),b.canvas.width=d,b.canvas.height=e}Fizz.DisplayGroup.prototype.init.call(this,null,!1),this._canvasContext=b,this._canvas=this._canvasContext.canvas,this._canvasWrapper=null,null!==this._canvas&&(this._size.x=this._canvas.width,this._size.y=this._canvas.height,this._canvasWrapper=new Fizz.Canvas(this._canvas),this._canvasWrapper.parent=this,this._setDelegatedCanvasListeners()),this.name="Stage"},draw:function(){null!==this._canvas&&(this._canvasContext.save(),this._canvasContext.clearRect(0,0,this._canvas.width,this._canvas.height),this.children.foreach(function(a){a instanceof Fizz.DisplayEntity&&a.draw__optimized(this._canvasContext)},this),this._canvasContext.restore())},toString:function(){var a=this._canvasContext.canvas;return null===a?"[Stage (canvas='null')]":String.format("[Stage (width='{0}', height='{1}')]",a.width,a.height)},_setDelegatedCanvasListeners:function(){var a=[Fizz.Canvas.EVENTS.CLICK,Fizz.Canvas.EVENTS.DBLCLICK,Fizz.Canvas.EVENTS.MOUSEUP,Fizz.Canvas.EVENTS.MOUSEDOWN,Fizz.Canvas.EVENTS.MOUSEMOVE];a.foreach(function(a){this.on(a,function(a){function b(a){var e=[];return"undefined"==typeof a.children?(d.position=a.globalPosition,d.size=a.size,d.intersects(c)&&e.push(a),e):(a.children.foreach(function(a){e.push.apply(e,b(a))}),e)}if(a.target===this._canvasWrapper){var c=new Fizz.Point(a.mouseX,a.mouseY),d=new Fizz.Rectangle,e=b(this);if(e.length>0){var f=a.clone();a.stopImmediatePropagation(),e[0].emit(f)}}})},this)}});a.DEFAULT_DIMENSIONS=new Fizz.Point(640,480),a.EVENTS={},a.prototype.exposeProperty("canvas","_canvasContext.canvas"),a.prototype.banishProperty("alpha"),a.prototype.exposeProperty("width","_canvas.width"),a.prototype.exposeProperty("height","_canvas.height"),a.prototype.banishProperty("stage"),a.prototype.banishProperty("exists"),a.prototype.banishProperty("life"),a.prototype.banishProperty("scale"),a.prototype.banishProperty("velocity"),a.prototype.banishProperty("acceleration"),Fizz.Stage=a,Fizz.logger.filter("dev").log("Loaded module 'Stage'.")}(),this.Fizz=this.Fizz||{},function(){var a=Fizz.EventEmitter.extend({init:function(a){if(this._loaded=!1,this._source=null,this._sourceImage=null,this._sourceImageCache=null,this._sourceImageCacheContext=null,this._sourceWidth=0,this._sourceHeight=0,this._frames=[],this._framesCache=[],this._animations={},this.on(Fizz.Spritesheet.EVENTS.LOAD,this._onImageLoad,!1),this.on(Fizz.Spritesheet.EVENTS.ERROR,this._onImageError,!1),("string"==typeof a||a instanceof Image&&a.src)&&(a={source:a}),"object"==typeof a&&null!==a&&("source"in a&&(this.source=a.source),"frames"in a)){var b=a.frames;"width"in b&&"height"in b?this.on(Fizz.Spritesheet.EVENTS.LOAD,function(){var a=0,c=0,d=b.width,e=b.height,f=b.count;f=f||this._sourceWidth/d*(this._sourceHeight/e);for(var g=0;f>g;g++)a>=this._sourceWidth&&(a=0,c+=e),this._frames[g]=[a,c,d,e],a+=d}):b instanceof Array&&(this._frames=b.filter(function(a){return 4===a.length})),"animations"in a&&a.animations.foreach(function(a,b){a instanceof Array&&a.length>=2?this._animations[b]={name:b,begin:a[0],end:a[1],speed:a[2]||1}:"number"==typeof a&&(this._animations[b]={name:b,begin:a,end:a,speed:1})},this)}},getFrame:function(a){return"number"!=typeof a&&(a=0),a in this._frames?(a in this._framesCache||this._refreshFrameCache(a),this._framesCache[a]):null},getAnimation:function(a){return this._animations[a]||null},toString:function(){return String.format("[Spritesheet (source='{0}')]",this._source||"null")},_setImageSource:function(a){function b(){this.emit(Fizz.Spritesheet.EVENTS.LOAD)}function c(){this.emit(Fizz.Spritesheet.EVENTS.ERROR)}"string"==typeof a?(this._source=a,this._sourceImage=new Image,this._sourceImage.onload=b.bind(this),this._sourceImage.onerror=c.bind(this),this._sourceImage.src=this._source):a instanceof Image&&a.src&&(this._source=a.src,this._sourceImage=a,this._sourceImage.complete?setTimeout(this.emit.bind(this,Fizz.Spritesheet.EVENTS.LOAD),10):(this._sourceImage.onload=b.bind(this),this._sourceImage.onerror=c.bind(this)))},_onImageLoad:function(){this._loaded=!0,this._sourceWidth=this._sourceImage.width,this._sourceHeight=this._sourceImage.height,this._refreshImageCache(),0===this._frames.length&&this._frames.push([0,0,this._sourceWidth,this._sourceHeight])},_onImageError:function(){Fizz.logger.filter("all").warn("Failed to load resource from '{0}'.",this._source)},_refreshImageCache:function(){null===this._sourceImageCache&&(this._sourceImageCache=document.createElement("canvas")),this._sourceImageCache.width=this._sourceWidth,this._sourceImageCache.height=this._sourceHeight,this._sourceImageCacheContext=this._sourceImageCache.getContext("2d"),this._sourceImageCacheContext.drawImage(this._sourceImage,0,0),this._framesCache={}},_refreshFrameCache:function(a){var b=this._frames[a];if(b){var c=new Fizz.Canvas(this._sourceImageCache);this._framesCache[a]=c.splice.apply(c,b)}}});Fizz.EventEmitter.initialize(a.prototype),a.EVENTS={},a.EVENTS.LOAD="load",a.EVENTS.ERROR="error",a.prototype.exposeProperty("sourceWidth"),a.prototype.exposeProperty("sourceHeight"),a.prototype.exposeProperty("loaded"),a.prototype.exposeProperty("source","_source",a.prototype._setImageSource),Fizz.Spritesheet=a,Fizz.logger.filter("dev").log("Loaded module 'Spritesheet'.")}(),this.Fizz=this.Fizz||{},function(){var a=Fizz.Spritesheet.extend({init:function(a){this._fontName=null,this._glyphSet=Fizz.Fontsheet.DEFAULT_GLYPH_SET;var b="Attempt was made to instantiate a Fontsheet without a valid glyphSet definition";("object"!=typeof a||null===a)&&Fizz.throws(b),("object"!=typeof a.glyphSet||null===a.glyphSet)&&Fizz.throws(b),"string"==typeof a.glyphSet.values&&a.glyphSet.values.length||Fizz.throws(b),"fontName"in a&&"string"==typeof a.fontName&&(this._fontName=a.fontName,delete a.fontName),a.frames={},a.frames.width=a.glyphSet.width,a.frames.height=a.glyphSet.height,a.frames.count=a.glyphSet.values.length,this._glyphSet=a.glyphSet.values,delete a.glyphSet,Fizz.Spritesheet.prototype.init.call(this,a)},getGlyphIndex:function(a){return this._glyphSet.indexOf(a)},getGlyph:function(a){return this.getFrame(this._glyphSet.indexOf(a))},getMetrics:function(){this.getFrame(0);var a={};return a.glyphCount=this._glyphSet.length,a.glyphWidth=this._framesCache[0].width,a.glyphHeight=this._framesCache[0].height,a},toString:function(){return String.format("[Fontsheet (fontName='{0}')]",this._fontName)}});a.DEFAULT_GLYPH_SET="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789.,!?'@#$%&()/-+=",a.prototype.exposeProperty("fontName"),Fizz.Fontsheet=a,Fizz.logger.filter("dev").log("Loaded module 'Fontsheet'.")}(),this.Fizz=this.Fizz||{},function(){var a=Fizz.DisplayEntity.extend({init:function(a){Fizz.DisplayEntity.prototype.init.call(this,null,!1),this._fillStyle=Fizz.Color.LIME,this._lineWidth=1,this._spritesheet=null,this._texture=Fizz.Graphic.DEFAULT_TEXTURE,this._localTexturesCache={},a instanceof Fizz.Spritesheet&&(this._spritesheet=a,a=null),("string"==typeof a||a instanceof Image&&a.src)&&(this._spritesheet=new Fizz.Spritesheet({source:a}),a=null),null!==a&&"object"==typeof a&&("scale"in a&&a.scale instanceof Fizz.Point&&(this.scaleX=a.scale.x,this.scaleY=a.scale.y,delete a.scale),this.assign(a)),this._spritesheet&&(this._spritesheet.loaded?this.updateCache():this._spritesheet.on("load",this.updateCache.bind(this)))},updateCache:function(){if(null===this._spritesheet||!1===this._spritesheet.loaded)return void Fizz.DisplayEntity.prototype.updateCache.call(this);var a=null;if(this._texture in this._localTexturesCache||(a=this._spritesheet.getFrame(this._texture),a.scale=Fizz.Graphic.NATIVE_SCALE.clone(),this._localTexturesCache[this._texture]=a,this._size=new Fizz.Point(a.width,a.height)),!1===this.scale.equals(this._localTexturesCache[this._texture].scale)){var b=new Fizz.Canvas(this._spritesheet.getFrame(this._texture));a=b.scale.call(b,this.scale.x,this.scale.y,!0),a.scale=this._scale.clone(),this._localTexturesCache[this._texture]=a}this._cacheCanvas=this._localTexturesCache[this._texture],this._cacheCanvasContext=this._cacheCanvas.getContext("2d")},copy:function(a){Fizz.DisplayEntity.prototype.copy.call(this,a),a instanceof Fizz.Graphic&&(this._spritesheet=a.spritesheet,this._texture=a.texture)},clone:function(){var a=new Fizz.Graphic;return a.copy(this),a},toString:function(){return String.format("[Graphic (name='{0}')]",this.name)}});a.DEFAULT_TEXTURE=0,a.NATIVE_SCALE=new Fizz.Point(1,1),a.prototype.exposeProperty("spritesheet","_spritesheet",Fizz.restrict.toInstanceType("_spritesheet","Fizz.Spritesheet")),a.prototype.exposeProperty("texture","_texture",Fizz.restrict.toRange("_texture",[0,1/0])),Fizz.Graphic=a,Fizz.logger.filter("dev").log("Loaded module 'Graphic'.")}(),this.Fizz=this.Fizz||{},function(){var a=Fizz.Graphic.extend({init:function(b){Fizz.Graphic.prototype.init.call(this,b,!1),this._currentAnimation=a.DEFAULT_ANIMATION,this._texture=this._currentAnimation.begin,this._paused=!0,this._timeUntilTransition=0,null!==b&&"object"==typeof b&&"animation"in b&&"string"==typeof b.animation&&(this.gotoAndPlay(b.animation),delete b.animation)},update:function(a){Fizz.Graphic.prototype.update.call(this,a),!1===this._paused&&this._currentAnimation.begin<this._currentAnimation.end&&(this._timeUntilTransition<=0?(this._advanceFrame(),this._timeUntilTransition=parseInt(1e3/this._currentAnimation.speed)):this._timeUntilTransition-=a)},play:function(){this._paused=!1},stop:function(){this._paused=!0},gotoAndPlay:function(a){this._goto(a),this.updateCache(),this.play()},gotoAndStop:function(a){this._goto(a),this.updateCache(),this.stop()},copy:function(a){Fizz.Graphic.prototype.copy.call(this,a),a instanceof Fizz.Sprite&&(this._currentAnimation=a.currentAnimation,this._paused=a.paused)},clone:function(){var a=new Fizz.Sprite;return a.copy(this),a},toString:function(){return String.format("[Sprite (name='{0}')]",this.name)},_goto:function(b){if(this._timeUntilTransition=0,"string"==typeof b){var c=this._spritesheet.getAnimation(b);this._currentAnimation=null!==c?c:this._currentAnimation,this._texture=this._currentAnimation.begin}else this._currentAnimation=a.DEFAULT_ANIMATION,this._texture=b},_advanceFrame:function(){var a=this._currentAnimation;this._texture===a.end&&a.next?(this._currentAnimation=this._spritesheet.getAnimation(a.next),this._texture=this._currentAnimation.begin):this._texture===a.end?this._texture=a.begin:this._texture+=1}});a.DEFAULT_ANIMATION={begin:0,end:0,next:null},a.prototype.exposeProperty("currentAnimation"),a.prototype.exposeProperty("paused"),Fizz.Sprite=a,Fizz.logger.filter("dev").log("Loaded module 'Sprite'.")}(),this.Fizz=this.Fizz||{},function(){var a=Fizz.DisplayGrid.extend({init:function(a){this._fontsheet=null,this._maxColumnLength=Fizz.Textbox.DEFAULT_MAX_COLUMN_LENGTH,this._content=" ",null!==a&&"object"==typeof a&&("fontsheet"in a&&a.fontsheet instanceof Fizz.Fontsheet&&(this._fontsheet=a.fontsheet,delete a.fontsheet),"content"in a&&"string"==typeof content&&(this.content=content,delete a.content)),Fizz.DisplayGrid.prototype.init.call(this,a),this._caching=!0,this._fontsheet&&(this._fontsheet.loaded?this.updateCache():this._fontsheet.on("load",this.updateCache.bind(this)))},updateCache:function(){var a=this._fontsheet.getMetrics();this._cellWidth=a.glyphWidth,this._cellHeight=a.glyphHeight,this._columns=Math.min(this._content.length,this._maxColumnLength),this._rows=Math.ceil(this._content.length/this._columns),this.empty(),this._content.foreach(function(a){var b=new Fizz.Graphic({spritesheet:this.fontsheet,texture:this.fontsheet.getGlyphIndex(a)});this.addChild(b)},this),Fizz.DisplayGroup.prototype.updateCache.call(this)},copy:function(a){Fizz.DisplayGrid.prototype.copy.call(this,a),a instanceof Fizz.Textbox&&(this._fontsheet=a.fontsheet,this._content=a.content,this._maxColumnLength=a.maxColumnLength,this.updateCache())},clone:function(){var a=new Fizz.Textbox;return a.copy(this),a},toString:function(){return String.format("[Text (content='{0}')]",this._content.toString())}});a.DEFAULT_MAX_COLUMN_LENGTH=32,a.EVENTS={},a.EVENTS.CONTENT_CHANGED="contentchanged",a.prototype.exposeProperty("fontsheet"),a.prototype.exposeProperty("content","_content",function(a){if("function"==typeof a.toString&&a.toString()!==this._content){var b=a.toString().trim();this._content=0===b.length?" ":b,null!==this.fontsheet&&!0===this.fontsheet.loaded&&this.updateCache(),this.emit(Fizz.Textbox.EVENTS.CONTENT_CHANGED,{content:this._content})}}),a.prototype.exposeProperty("maxColumnLength","_maxColumnLength",Fizz.restrict.toNumber("_maxColumnLength")),a.prototype.banishProperty("width"),a.prototype.banishProperty("height"),Fizz.Textbox=a,Fizz.logger.filter("dev").log("Loaded module 'Textbox'.")}(),this.Fizz=this.Fizz||{},function(){var a=Object.extend({init:function(b,c,d){this._stage=null,this._framerate=a.DEFAULT_FRAME_RATE,this._actualFramerate=0,this._logFPS=!1,this._rendering=!1,this._lastRenderTime=0,this._RAFCallbackHandle=null,this.stage=b,this.framerate=c,this.logFPS=d},start:function(){if(!this._rendering&&null!==this._stage){this._rendering=!0,this._lastRenderTime=+new Date;var a=this._getRAFMethod(),b=function(c){this._actualFramerate=c-this._lastRenderTime,this._logFPS&&0===(63&c)&&Fizz.logger.filter("all").log("Rendering {0} frames per seconds",(1e3/this._actualFramerate).toFixed(2)),this._stage.draw(),this._lastRenderTime=c;var d=function(){b.call(this,+new Date)}.bind(this);this._RAFCallbackHandle=a.call(window,d,this._framerate)}.bind(this);b(this._lastRenderTime)}},stop:function(){if(this._rendering){this._rendering=!1;var a=this._getCAFMethod();a(this._RAFCallbackHandle)}},toString:function(){return String.format("[RAFRenderer (rendering='{0}', framerate='{1}', logFPS='{2}')]",this._rendering.toString(),this._framerate.toFixed(2),this._logFPS.toString())},_getRAFMethod:function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.setTimeout},_getCAFMethod:function(){return window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.clearTimeout}});a.DEFAULT_FRAME_RATE=1e3/60,a.prototype.exposeProperty("rendering"),a.prototype.exposeProperty("stage","_stage",Fizz.restrict.toInstanceType("_stage","Fizz.Stage")),a.prototype.exposeProperty("framerate","_framerate",Fizz.restrict.toRange("_framerate",[10,1/0])),a.prototype.exposeProperty("actualFramerate"),a.prototype.exposeProperty("actualFPS",function(){return(1e3/this._actualFramerate).toFixed(2)}),a.prototype.exposeProperty("logFPS","_logFPS",Fizz.restrict.toBoolean("_logFPS")),Fizz.RAFRenderer=a,Fizz.logger.filter("dev").log("Loaded module 'RAFRenderer'.")}(),this.Fizz=this.Fizz||{},function(){var a=Object.extend({init:function(){if(this._tickRate=a.DEFAULT_TICK_RATE,this._initTime=null,this._tickTimeout=null,arguments[0]instanceof Fizz.Stage)this._stage=stage;else{var b=Array.prototype.slice.call(arguments,0);this._stage=new(Function.prototype.bind.apply(Fizz.Stage,[null].concat(b)))}this._renderer=new Fizz.RAFRenderer(this._stage),this.play()},play:function(){null===this._tickTimeout&&(this._initTime=this._initTime||+new Date,this._tick(),this._renderer.start())},pause:function(){window.clearTimeout(this._tickTimeout),this._tickTimeout=null,this._renderer.stop()},toString:function(){return"[Demo (stage='{0}')]".format(this._stage.toString())},_tick:function b(){this._tickTimeout=window.setTimeout(function(){this.stage.update(1),b.call(this)}.bind(this),this._tickRate)}});a.DEFAULT_TICK_RATE=10,a.prototype.exposeProperty("stage"),a.prototype.exposeProperty("tickRate"),a.prototype.exposeProperty("initTime"),a.prototype.exposeProperty("uptime",function(){return+new Date-this._initTime}),Fizz.Demo=a,Fizz.logger.filter("dev").log("Loaded module 'Demo'.")}();
//# sourceMappingURL=fizz.min.js.map